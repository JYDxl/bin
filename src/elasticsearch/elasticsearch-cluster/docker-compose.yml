version: '3'
services:

  elasticsearch-cluster0:
    image: bitnami/elasticsearch:7.15.1
    container_name: elasticsearch-cluster0
    hostname: elasticsearch-cluster0
    environment:
      - ELASTICSEARCH_CLUSTER_NAME=elasticsearch-cluster
      - ELASTICSEARCH_CLUSTER_HOSTS=elasticsearch-cluster0,elasticsearch-cluster1,elasticsearch-cluster2,elasticsearch-cluster3
      - ELASTICSEARCH_NODE_NAME=elasticsearch-cluster0
      - TZ=Asia/Shanghai
    volumes:
      - ../plugins/elasticsearch-analysis-ik-7.15.1.zip:/bitnami/elasticsearch/plugins/analysis-ik-7.15.1.zip
      - /opt/volumes/elasticsearch-cluster0:/bitnami/elasticsearch/data
      - /opt/volumes/extra:/extra
    ports:
      - "9200:9200"
    networks:
      - backend
  elasticsearch-cluster1:
    image: bitnami/elasticsearch:7.15.1
    container_name: elasticsearch-cluster1
    hostname: elasticsearch-cluster1
    environment:
      - ELASTICSEARCH_CLUSTER_NAME=elasticsearch-cluster
      - ELASTICSEARCH_CLUSTER_HOSTS=elasticsearch-cluster0,elasticsearch-cluster1,elasticsearch-cluster2,elasticsearch-cluster3
      - ELASTICSEARCH_NODE_NAME=elasticsearch-cluster1
      - TZ=Asia/Shanghai
    volumes:
      - ../plugins/elasticsearch-analysis-ik-7.15.1.zip:/bitnami/elasticsearch/plugins/analysis-ik-7.15.1.zip
      - /opt/volumes/elasticsearch-cluster1:/bitnami/elasticsearch/data
      - /opt/volumes/extra:/extra
    ports:
      - "9201:9200"
    networks:
      - backend
  elasticsearch-cluster2:
    image: bitnami/elasticsearch:7.15.1
    container_name: elasticsearch-cluster2
    hostname: elasticsearch-cluster2
    environment:
      - ELASTICSEARCH_CLUSTER_NAME=elasticsearch-cluster
      - ELASTICSEARCH_CLUSTER_HOSTS=elasticsearch-cluster0,elasticsearch-cluster1,elasticsearch-cluster2,elasticsearch-cluster3
      - ELASTICSEARCH_NODE_NAME=elasticsearch-cluster2
      - TZ=Asia/Shanghai
    volumes:
      - ../plugins/elasticsearch-analysis-ik-7.15.1.zip:/bitnami/elasticsearch/plugins/analysis-ik-7.15.1.zip
      - /opt/volumes/elasticsearch-cluster2:/bitnami/elasticsearch/data
      - /opt/volumes/extra:/extra
    ports:
      - "9202:9200"
    networks:
      - backend
  elasticsearch-cluster3:
    image: bitnami/elasticsearch:7.15.1
    container_name: elasticsearch-cluster3
    hostname: elasticsearch-cluster3
    environment:
      - ELASTICSEARCH_CLUSTER_NAME=elasticsearch-cluster
      - ELASTICSEARCH_CLUSTER_HOSTS=elasticsearch-cluster0,elasticsearch-cluster1,elasticsearch-cluster2,elasticsearch-cluster3
      - ELASTICSEARCH_NODE_NAME=elasticsearch-cluster3
      - TZ=Asia/Shanghai
    volumes:
      - ../plugins/elasticsearch-analysis-ik-7.15.1.zip:/bitnami/elasticsearch/plugins/analysis-ik-7.15.1.zip
      - /opt/volumes/elasticsearch-cluster3:/bitnami/elasticsearch/data
      - /opt/volumes/extra:/extra
    ports:
      - "9203:9200"
    networks:
      - backend
  elasticsearch-kibana:
    image: bitnami/kibana:7.15.1
    container_name: elasticsearch-kibana
    hostname: elasticsearch-kibana
    environment:
      - KIBANA_ELASTICSEARCH_URL=elasticsearch-cluster0
      - TZ=Asia/Shanghai
    volumes:
      - /opt/volumes/elasticsearch-kibana:/bitnami/kibana/data
    ports:
      - "5601:5601"
    networks:
      - backend
    depends_on:
      - elasticsearch-cluster0
      - elasticsearch-cluster1
      - elasticsearch-cluster2
      - elasticsearch-cluster3

networks:
  backend:
    external: true
